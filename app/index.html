<!doctype html>
<html class="no-js" ng-app="unchatbar-data-chat">
<head>
  <meta charset="utf-8">
  <base href="/">
  <title>unchatbar connection</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <!-- build:css(.) styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="bower_components/highlightjs/styles/default.css" />
  <link rel="stylesheet" href="bower_components/ng-emoticons/src/ng-emoticons.css" />
  <!-- endbower -->
  <!-- endbuild -->
  <!-- build:css(.tmp) styles/main.css -->
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild -->
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">

      <a href="#" class="navbar-brand">unchatbar Data chat</a>
    </div>
  </div>
</nav>
<div class="container" ng-controller="unDataChatDemo">
  <div class="jumbotron">
    <div ng-repeat="(channel,userMap) in channelList" class="container-fluid pull-left">
      <div class="panel panel-primary ">
        <div class="panel-heading">Channel:{{channel}}</div>
        <div class="panel-body">
          <div ng-repeat="user in userMap" class="pull-left">
            <div style="height: 100px;">
              <img class="profile-image" ng-src="{{user.image}}" width="80">

            </div>
            {{user.label}}
            <br/>
            <button class="btn btn-default" data-ng-click="join(user.id)">select user</button>
          </div>
        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  <div data-ng-show="ownPeerId" data-ng-init="activeChannel='GruppeA'">
    <div class="row">
      <div class="col-sx-12">
        <div class="page-header">
          {{userMap[ownPeerId].label}}
        </div>
        <ul class="nav nav-tabs">
          <li role="presentation" data-ng-repeat="(channel,userMap) in channelList"
              ui-sref-active="active">

            <a ui-sref="channel({channel: channel})">{{channel}}</a>
          </li>
          <li>
            <a href="#" data-ng-click="showUnread=!showUnread" style="color:#444">
              <i class="fa fa-envelope fa-lg"></i>

              <un-data-chat-count-unread-message addition-class="'badge-primary'"></un-data-chat-count-unread-message>
            </a>
            <un-data-chat-unread-message data-user-map="userMap"
                                         data-ng-show="showUnread"></un-data-chat-unread-message>
          </li>
        </ul>
      </div>
    </div>
    <br/>

    <div class="row">
      <div class="col-xs-12">
        <div ng-show="channelList[activeChannel][ownPeerId]">
          <un-data-chat-message-box data-channel="{{activeChannel}}"
                                    data-user-map="channelList[activeChannel]"></un-data-chat-message-box>

        </div>
        <div ng-show="!channelList[activeChannel][ownPeerId]">
          you are no member of group {{activeChannel}}
        </div>
      </div>
      <div class="col-xs-1">
        <un-data-chat-send-file data-channel="{{activeChannel}}"
                                data-user-map="channelList[activeChannel]"></un-data-chat-send-file>
      </div>
      <div class="col-xs-11">
        <un-data-chat-send-box data-channel="{{activeChannel}}"
                               data-user-map="channelList[activeChannel]"></un-data-chat-send-box>
      </div>
    </div>
  </div>
</div>

<!--[if lt IE 7]>
<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
  your browser</a> to improve your experience.</p>
<![endif]-->


<!-- build:js(.) scripts/oldieshim.js -->
<!--[if lt IE 9]>
<script src="bower_components/es5-shim/es5-shim.js"></script>
<script src="bower_components/json3/lib/json3.js"></script>
<![endif]-->
<!-- endbuild -->


<!-- build:js(.) scripts/vendor.js -->
<!-- bower:js -->
<script src="bower_components/angular/angular.js"></script>
<script src="bower_components/angular-elastic/elastic.js"></script>
<script src="bower_components/angular-gettext/dist/angular-gettext.js"></script>
<script src="bower_components/angular-scroll-glue/src/scrollglue.js"></script>
<script src="bower_components/angular-ui-router/release/angular-ui-router.js"></script>
<script src="bower_components/dexie/dist/latest/Dexie.min.js"></script>
<script src="bower_components/highlightjs/highlight.pack.js"></script>
<script src="bower_components/lodash/dist/lodash.compat.js"></script>
<script src="bower_components/angular-sanitize/angular-sanitize.js"></script>
<script src="bower_components/ng-emoticons/src/ng-emoticons.js"></script>
<script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>
<script src="bower_components/ngstorage/ngStorage.js"></script>
<script src="bower_components/peerjs/peer.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/app.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/run.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/translations.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/provider/broker.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/service/data-connection.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/service/peer.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/directive/dialer.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/directive/login.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/controller/dialer.js"></script>
<script src="bower_components/unchatbar-connection/app/scripts/controller/model-password.js"></script>
<!-- endbower -->
<!-- endbuild -->

<!-- build:js({.tmp,app}) scripts/scripts.js -->
<script src="scripts/constants.js"></script>
<script src="scripts/app.js"></script>
<!-- Provider -->

<!-- Config -->
<script src="scripts/config/broker.js"></script>
<script src="scripts/config/state.js"></script>
<script src="scripts/config/compile.js"></script>
<!-- Controller -->
<script src="scripts/controller/text.js"></script>
<!-- Service -->
<script src="scripts/service/message.js"></script>
<!-- directive -->
<script src="scripts/directive/enter.js"></script>
<script src="scripts/directive/message-box.js"></script>
<script src="scripts/directive/unread-message.js"></script>
<script src="scripts/directive/send-box.js"></script>
<script src="scripts/directive/send-file.js"></script>
<script src="scripts/directive/file-reader.js"></script>
<script src="scripts/directive/get-blob-url.js"></script>
<script src="scripts/directive/count-unread.js"></script>
<!-- run -->
<script src="scripts/run.js"></script>
<!-- endbuild -->


<script>
  angular.module('unchatbar-data-chat').run(function (Broker) {
    //Broker.connectServer();
  });

  angular.module('unchatbar-data-chat').controller('unDataChatDemo',
    function ($scope, $stateParams, Broker) {
      $scope.showUnread = false;
      $scope.userMap = {
        'admin': {
          id: 'admin',
          label: 'Der Admin',
          image: '/images/admin.jpg'

        },
        'mia': {
          id: 'mia',
          label: 'Mia',
          image: '/images/support.jpg'

        },
        'meier': {
          id: 'meier',
          label: 'Herr Meier',
          image: '/images/sales.jpg'

        },
        'girlNextDoor': {
          id: 'girlNextDoor',
          label: 'girl next door',
          image: '/images/girl-next-door.jpg'

        }
      };

      $scope.channelList = {
        GruppeA: {
          admin: $scope.userMap.admin,
          mia: $scope.userMap.mia,
          meier: $scope.userMap.meier
        },
        privateChat: {
          meier: $scope.userMap.meier,
          girlNextDoor: $scope.userMap.girlNextDoor
        }
      };

      $scope.join = function (id) {
        Broker.setPeerId(id);
        Broker.connectServer();
      };
      $scope.$on('BrokerPeerOpen', function (event, data) {
        $scope.ownPeerId = Broker.getPeerIdFromStorage();
      });

      $scope.$on('$stateChangeSuccess', function () {
        $scope.showUnread = false;
        $scope.activeChannel = $stateParams.channel;
      });

      $scope.ownPeerId = Broker.getPeerIdFromStorage();
      if ($scope.ownPeerId) {
        $scope.join($scope.ownPeerId);
      }
    });
</script>
</body>
</html>
